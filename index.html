  <!doctype html>
  <html lang="it">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>One Piece ‚Äî Squadre</title>
  <style>
  :root { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    --primary: #4f74ff;
    --secondary: #2b356f;
    --highlight: #ffdd57;
    --bg-card: #1a2040;
    --bg-body: #0b1020;
    --pill-cap: #ff4f4f;
    --pill-vice: #4f94ff;
    --pill-fighter: #4fff7f;
    --glow-bounty: rgba(255,215,0,0.6);
    --glow-devil: rgba(255,0,255,0.6);
    --glow-both: rgba(0, 255, 255, 0.685);
    --glow-conqueror: rgba(255,0,0,0.6);
  }

/* --- Page Background --- */
body {
  margin: 0;
  font-family: 'Pirata One', sans-serif;
  background: 
    url('images/parchment-texture.jpg') center/cover no-repeat fixed, /* old paper */
    linear-gradient(180deg, #f4fcff 0%, #1e3f66 100%); /* sky to ocean gradient */
  background-blend-mode: multiply;
  color: #3b2f1a;
}

/* Optional: add a subtle overlay of a map */
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('images/one-piece-map.png') center/contain repeat;
  opacity: 0.15;
  z-index: -1;
  pointer-events: none;
}

/* Scrollbar Styling (optional) */
::-webkit-scrollbar {
  width: 10px;
}
::-webkit-scrollbar-track {
  background: rgba(245, 222, 179, 0.5);
}
::-webkit-scrollbar-thumb {
  background: #b88b57;
  border-radius: 5px;
}
::-webkit-scrollbar-thumb:hover {
  background: #a0713d;
}
  .attributes {
    background: rgba(255, 224, 186, 0.18);
    border: 2px solid #c49a6c;
    border-radius: 12px;
    padding: 10px;
    margin-top: 8px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.15);
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
  }

.attributes .pill, .grid .pill {
  font-family: 'Treasure Map Deadhand', cursive;
  font-weight: bold;
  background: linear-gradient(to bottom, #fef3c2, #f2d7b4);
  border: 2px solid #b88b57;
  color: #5a3e1b;
  box-shadow: 0 2px 4px rgba(0,0,0,0.25);
}

  .attributes .pill:hover {
    transform: scale(1.05);
    background: linear-gradient(to bottom, #fff7e6, #f5d9b0);
  }

  .aliases {
    margin-top: 8px;
    font-style: italic;
    font-size: 12px;
    opacity: 0.85;
    text-align: center;
  }


  .card-container { 
    display: flex; 
    gap: 20px; 
    flex-wrap: wrap; 
    justify-content: center; 
    margin-bottom: 20px; 
  }

.card {
  position: relative;
  overflow: visible;
  width: min(320px, 92vw);
  background: linear-gradient(145deg, #f4e0c3, #d9b98b); /* aged paper gradient */
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,.6);
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s, filter 0.3s;
  font-family: 'Treasure Map Deadhand', cursive; /* pirate style font */
  color: #3b2f1a;
  border: 2px solid #b88b57;
}
  .card:hover { 
    transform: translateY(-8px) scale(1.02); 
    box-shadow: 0 20px 50px rgba(0,0,0,.8); 
    filter: brightness(1.05);
  }
  /* Conqueror's Haki Lightning Aura */

/* Conqueror's Haki Lightning Aura - always visible */
.card-conqueror {
  position: relative; 
  overflow: visible;
  box-shadow: 0 0 35px 12px var(--glow-conqueror); /* stronger by default */
  transition: transform 0.3s, box-shadow 0.3s, filter 0.3s;
}
.card-conqueror::before {
  content: "";
  position: absolute;
  top: -30px;
  left: -30px;
  right: -30px;
  bottom: -30px;
  background: url('images/light.png') repeat;
  background-size: contain;
  z-index: -1;
  pointer-events: none;
  filter: brightness(1.5) blur(2px);
  opacity: 0.8;
  animation: flashAura 1s infinite;
}

@keyframes flashAura {
  0%   { opacity: 0.7; }
  10%  { opacity: 1; }
  20%  { opacity: 0.4; }
  30%  { opacity: 0.8; }
  40%  { opacity: 0.5; }
  50%  { opacity: 1; }
  60%  { opacity: 0.3; }
  70%  { opacity: 0.9; }
  80%  { opacity: 0.6; }
  90%  { opacity: 1; }
  100% { opacity: 0.7; }
}



/* Hover just makes it stronger and moves the card */
.card-conqueror:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 0 35px 12px var(--glow-conqueror), 0 20px 50px rgba(0,0,0,.8);
  filter: brightness(1.05);
}



/* Hero Image */
.hero {
  width: 100%; /* fill card width */
  height: auto;
  max-height: 380px; /* increased from your current value */
  object-fit: contain; /* keeps proportions without cropping */
  display: block;
  margin: 0 auto;
  border: 4px solid #8B4513; /* pirate poster frame look */
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}


 .content {
  padding: 20px 22px 24px;
  background: rgba(255, 248, 220, 0.85); /* slightly transparent parchment look */
  border-radius: 0 0 20px 20px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
  border-top: 2px solid #b88b57;
}

h1 {
  margin: 0 0 6px;
  font-size: 26px;
  color: #b84100; /* bold pirate red */
  text-shadow: 2px 2px 0 #fef3c2, 0 0 6px rgba(0,0,0,.5);
}

.meta {
  opacity: 0.9;
  font-size: 14px;
  font-style: italic;
  color: #4b3621;
  text-shadow: 1px 1px 0 #fff3c2;
  margin-bottom: 10px;
  text-align: center;
}

  .grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 12px; 
    margin: 12px 0; 
  }

  .pill { 
    background: var(--secondary); 
    padding: 8px 10px; 
    border-radius: 999px; 
    text-align: center; 
    font-size: 13px; 
    transition: background 0.2s; 
  }
  .pill:hover { 
    background: var(--primary); 
  }

  .actions { 
    display: flex; 
    gap: 12px; 
    margin-bottom: 12px; 
    flex-wrap: wrap; 
    justify-content: center; 
  }
  button { 
    cursor: pointer; 
    border: 0; 
    border-radius: 999px; 
    padding: 12px 20px; 
    font-weight: 700; 
    background: var(--primary); 
    color: white; 
    transition: background 0.2s, transform 0.2s; 
  }
  button:hover { 
    background: #627fff; 
    transform: scale(1.05);
  }
  button.secondary { 
    background: var(--secondary); 
  }

  #counter { 
    margin-top: 8px; 
    font-size: 14px; 
    opacity: .9; 
    text-align: center; 
    color: var(--highlight);
  }

  .footer { 
    opacity: .6; 
    font-size: 12px; 
    text-align: center; 
    padding: 10px 0 18px; 
  }

  .teams { 
    display: flex; 
    gap: 40px; 
    margin-top: 20px; 
    flex-wrap: wrap; 
    justify-content: center; 
  }

  .team { 
    background: linear-gradient(145deg, #013c53, #013c53); 
    padding: 16px; 
    border-radius: 20px; 
    width: 320px; 
    box-shadow: 0 10px 30px rgba(245, 237, 237, 0.5); 
    transition: transform 0.2s; 
  }
  .team:hover { 
    transform: translateY(-5px); 
  }
  .team h2 { 
    margin-top: 0; 
    text-align: center; 
    color: var(--highlight); 
    font-weight: 700; 
    font-size: 20px;
    text-shadow: 0 2px 4px rgba(238, 226, 226, 0.6);
  }

  .role { 
    margin: 8px 0; 
    padding: 10px 12px; 
    border-radius: 12px; 
    font-size: 14px; 
    cursor: pointer; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    transition: background 0.2s, transform 0.2s; 
  }
  .role.capitano { background: var(--pill-cap); color: white; }
  .role.vice { background: var(--pill-vice); color: white; }
  .role.combattente { background: var(--pill-fighter); color: #d8e1ff; }
  .role:hover { 
    opacity: 0.85; 
    transform: scale(1.02);
  }
  .selected { 
    outline: 3px solid var(--highlight); 
  }

  .role-menu { 
    position: absolute; 
    background: var(#f0e4ff); 
    border: 1px solid var(--primary); 
    border-radius: 12px; 
    padding: 8px; 
    display: none; 
    z-index: 10; 
    box-shadow: 0 8px 20px rgba(0,0,0,0.7);
    transition: opacity 0.1s ease;
  }
  .role-menu div { 
    padding: 8px 12px; 
    cursor: pointer; 
    border-radius: 8px; 
  }
  .role-menu div:hover { 
    background: var(--primary); 
    color: white; 
  }

.legend {
  display: flex;
  flex-wrap: wrap;
  gap: 14px;
  justify-content: center;
  align-items: center;
  font-family: 'One Piece', sans-serif;
  font-size: 14px;
  background: rgba(0,0,0,0.6);
  padding: 10px 15px;
  border: 3px solid #d4a373;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
  color: #ffd66b; /* üåü colore testo leggibile */
  text-shadow: 1px 1px 2px #000; /* pi√π contrasto */
}

.legend h3 {
  margin: 0 100% 8px 0;
  font-size: 16px;
  text-decoration: underline;
  color: #ffeb9c; /* leggermente pi√π chiaro per il titolo */
  text-shadow: 2px 2px 3px #000;
}

.legend-box {
  display: inline-block;
  width: 20px;
  height: 20px;
  border-radius: 4px;
  margin-right: 6px;
  box-shadow: 0 0 6px rgba(255,255,255,0.4);
}

.glow-bounty { background: gold; box-shadow: 0 0 10px gold; }
.glow-devil { background: violet; box-shadow: 0 0 10px violet; }
.glow-both { background: rgba(0, 255, 255, 0.685); box-shadow: 0 0 10px gold; }
.glow-conqueror { background: red; box-shadow: 0 0 10px red; }
.glow-lightning { 
  background: url('images/light.png') center/cover no-repeat; 
  border: 1px solid rgba(255,255,255,0.5);
}

  </style>
  </head>
  <body>

  <div class="actions">
    <button id="randomBtn">üé≤ Random</button>
    <button id="noRepeatBtn" class="secondary">üîÅ No ripetizioni</button>
  </div>
  <div id="counter">0 / 0</div>
  <div class="card-container" id="cards"></div>

  <div class="teams">
    <div class="team" id="team1">
      <h2>Giocatore 1</h2>
      <div class="role capitano" data-role="Capitano">Capitano: ‚Äî</div>
      <div class="role vice" data-role="Vice Capitano">Vice Capitano: ‚Äî</div>
      <div class="role combattente" data-role="Primo Combattente">Primo Combattente: ‚Äî</div>
      <div class="role combattente" data-role="Secondo Combattente">Secondo Combattente: ‚Äî</div>
      <div class="role combattente" data-role="Terzo Combattente">Terzo Combattente: ‚Äî</div>
    </div>
    <div class="team" id="team2">
      <h2>Giocatore 2</h2>
      <div class="role capitano" data-role="Capitano">Capitano: ‚Äî</div>
      <div class="role vice" data-role="Vice Capitano">Vice Capitano: ‚Äî</div>
      <div class="role combattente" data-role="Primo Combattente">Primo Combattente: ‚Äî</div>
      <div class="role combattente" data-role="Secondo Combattente">Secondo Combattente: ‚Äî</div>
      <div class="role combattente" data-role="Terzo Combattente">Terzo Combattente: ‚Äî</div>
    </div>
  </div>

  <div class="role-menu" id="roleMenu"></div>

 <div class="legend">
  <div><span class="legend-box glow-bounty"></span> Bounty > 2.5B</div>
  <div><span class="legend-box glow-devil"></span> Devil Fruit</div>
  <div><span class="legend-box glow-both"></span> Bounty + Devil Fruit</div>
  <div><span class="legend-box glow-conqueror"></span> Conqueror‚Äôs Haki</div>
</div>


  <div class="footer">One Piece fan project ‚Äî solo per uso personale</div>

  <script>
  let data = [];
  let pool = [];
  let totalCharacters = 0;
  let currentPlayer = 1;
  let currentChar = null;

  const $ = (id) => document.getElementById(id);

  async function load() {
    const res = await fetch('characters.json');
    data = await res.json();
    totalCharacters = data.length;
    pool = [...data];
    showCards([randomFrom(data)]);
    updateCounter();
  }

  function randomFrom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function showCards(chars) {
  const container = $('cards');
  container.innerHTML = "";
  chars.forEach(char => {
    const card = document.createElement("div");
    card.className = "card";

    // Glow effects for bounty/devil fruit
    if (char.bounty && parseInt(char.bounty.replace(/\D/g,'')) > 2500000000 
        && char.devil_fruit && char.conqueror_haki) {
          card.classList.add("conqueror");
          card.classList.add("card-conqueror");; // üî• Add aura animation
    } else if (char.conqueror_haki) {
      card.classList.add("conqueror");
      card.classList.add("card-conqueror"); // üî• Add aura animation
    } else if (char.bounty && parseInt(char.bounty.replace(/\D/g,'')) > 2500000000 
               && char.devil_fruit) {
      card.style.boxShadow = `0 0 20px 5px var(--glow-both)`;
    } else if (char.bounty && parseInt(char.bounty.replace(/\D/g,'')) > 2500000000) {
      card.style.boxShadow = `0 0 20px 5px var(--glow-bounty)`;
    } else if (char.devil_fruit) {
      card.style.boxShadow = `0 0 20px 5px var(--glow-devil)`;
    }

    card.innerHTML = `
      <img class="hero" src="${char.image}" alt="${char.name}">
      <div class="content">
        <h1>${char.name}</h1>
        <div class="meta">${char.crew || '‚Äî'}</div>
        <div class="grid">
          <div class="pill">${char.role || '‚Äî'}</div>
          <div class="pill">${char.bounty ? `Bounty: ${char.bounty}` : 'Bounty: ‚Äî'}</div>
        </div>
        <div class="grid">
          <div class="pill">${(char.aliases && char.aliases.length) ? char.aliases.join(', ') : '‚Äî'}</div>
          <div class="pill">Devil fruit: ${char.devil_fruit ?? '‚Äî'}</div>
        </div>
      </div>
    `;

    card.addEventListener('click', (e) => showRoleMenu(e, char));
    container.appendChild(card);
  });
}

  function updateCounter() {
    const used = totalCharacters - pool.length;
    $('counter').textContent = `${used} / ${totalCharacters}`;
  }

  $('randomBtn').addEventListener('click', () => {
    showCards([randomFrom(data)]);
  });

  $('noRepeatBtn').addEventListener('click', () => {
    if (pool.length === 0) {
      alert("Tutti i personaggi sono stati mostrati! Si ricomincia.");
      pool = [...data];
    }
    const idx = Math.floor(Math.random() * pool.length);
    const pick = pool.splice(idx, 1)[0];
    showCards([pick]);
    updateCounter();
  });

  function showRoleMenu(e, char) {
    currentChar = char;
    const menu = $('roleMenu');
    menu.innerHTML = '';
    const team = currentPlayer === 1 ? 'team1' : 'team2';
    const roles = Array.from($(team).querySelectorAll('.role'));
    roles.forEach(roleDiv => {
      if (roleDiv.textContent.endsWith('‚Äî')) {
        const item = document.createElement('div');
        item.textContent = roleDiv.dataset.role;
        item.addEventListener('click', () => assignCharacterToRole(roleDiv));
        menu.appendChild(item);
      }
    });
    menu.style.display = 'block';
    menu.style.top = e.clientY + 'px';
    menu.style.left = e.clientX + 'px';
  }

  function assignCharacterToRole(roleDiv) {
    roleDiv.textContent = `${roleDiv.dataset.role}: ${currentChar.name}`;
    $('roleMenu').style.display = 'none';
    currentPlayer = currentPlayer === 1 ? 2 : 1;
  }

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.card') && !e.target.closest('#roleMenu')) {
      $('roleMenu').style.display = 'none';
    }
  });

  load();
  </script>

  </body>
  </html>
